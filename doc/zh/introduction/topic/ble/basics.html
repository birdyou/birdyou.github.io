<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<meta name="description" content="">
<meta name="author" content="">
<title>JUMA SDK</title>
<!-- Bootstrap core CSS -->
<link href="http://www.juma.io/doc/static/css/bootstrap.min.css" rel="stylesheet">
<link href="http://www.juma.io/doc/static/css/table.css" rel="stylesheet">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
<style>
.navbar-brand{
padding:0px;
width: 120px;
background-image: url("http://www.juma.io/doc/static/JUMA-LOGO.png");
background-size: 60% 40%;
background-repeat: no-repeat;
background-position: center;
}
.content-section-a {
padding: 20px 0;
background-color: #f8f8f8;
}
.well-font { font-size: 16px; }
</style>
<SCRIPT>
var menu_wwwzzjsnet=function(){
var t=15,z=50,s=6,a;
function dd(n){this.n=n; this.h=[]; this.c=[]}
dd.prototype.init=function(p,c){
a=c; var w=document.getElementById(p), s=w.getElementsByTagName('ul'), l=s.length, i=0;
for(i;i<l;i++){
var h=s[i].parentNode; this.h[i]=h; this.c[i]=s[i];
h.onmouseover=new Function(this.n+'.st('+i+',true)');
h.onmouseout=new Function(this.n+'.st('+i+')');
}
}
dd.prototype.st=function(x,f){
var c=this.c[x], h=this.h[x], p=h.getElementsByTagName('a')[0];
clearInterval(c.t); c.style.overflow='hidden';
if(f){
p.className+=' '+a;
if(!c.mh){c.style.display='block'; c.style.height=''; c.mh=c.offsetHeight; c.style.height=0}
if(c.mh==c.offsetHeight){c.style.overflow='visible'}
else{c.style.zIndex=z; z++; c.t=setInterval(function(){sl(c,1)},t)}
}else{p.className=p.className.replace(a,''); c.t=setInterval(function(){sl(c,-1)},t)}
}
function sl(c,f){
var h=c.offsetHeight;
if((h<=0&&f!=1)||(h>=c.mh&&f==1)){
if(f==1){c.style.filter=''; c.style.opacity=1; c.style.overflow='visible'}
clearInterval(c.t); return
}
var d=(f==1)?Math.ceil((c.mh-h)/s):Math.ceil(h/s), o=h/c.mh;
c.style.opacity=o; c.style.filter='alpha(opacity='+(o*100)+')';
c.style.height=h+(d*f)+'px'
}
return{dd:dd}
}();
</SCRIPT>
</head>
<body>
<nav class="navbar navbar-inverse">
<div class="container">
<div class="navbar-header">
<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://www.juma.io"></a>
</div>
<div id="navbar" class="collapse navbar-collapse">
<ul class="nav navbar-nav">
<li><a href="http://www.juma.io/doc/zh/introduction/index.html">概述</a></li>
<li><a href="http://www.juma.io/doc/zh/boards.html">硬件</a></li>
<li><a href="http://www.juma.io/doc/zh/embedded_sdk.html">嵌入式</a></li>
<li><a href="http://www.juma.io/doc/zh/android_sdk.html">Android</a></li>
<li><a href="http://www.juma.io/doc/zh/ios_sdk.html">iOS</a></li>
</ul>
</div><!-- /.nav-collapse -->
</div><!-- /.container -->
</nav><!-- /.navbar -->
<div class="container">
<div class="row row-offcanvas row-offcanvas-right">
<div class="col-xs-12 col-sm-9">
<h1 id="ble基本概念">BLE基本概念</h1>
<hr />
<h2 id="ble物理层">BLE物理层</h2>
<h3 id="rf规格特性">RF规格特性</h3>
<ul>
<li>运行在2.4GHz ISM频段</li>
<li>GFSK 调制方式(高斯频移键控)</li>
<li>Bit-rate：1Mbit/s</li>
</ul>
<h3 id="广播通道">广播通道</h3>
<ul>
<li>40个频道，2MHz的频道间隙</li>
<li>3 个固定的广播通道</li>
<li>37 个自适应自动跳频数据通道</li>
</ul>
<div class="figure">
<img src="ble1.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<h3 id="星形拓扑结构">星形拓扑结构</h3>
<ul>
<li>主设备管理着连接,并且可以连接多个从设备</li>
<li>一个从设备只能连接一个主设备</li>
</ul>
<hr />
<h2 id="ble设备状态">BLE设备状态</h2>
<h3 id="有六种可能的状态">有六种可能的状态</h3>
<ul>
<li>待机状态(Standby)：设备没有传输和发送数据，没有连接到任何设备</li>
<li>广播状态(Advertiser)：周期性广播状态</li>
<li>扫描状态(Scanner)：主动地寻找正在广播的设备</li>
<li>发起连接状态(Initiator)：主动向某个设备发起连接</li>
<li>主设备(Master)：已建立连接的设备，主动发起连接的一方</li>
<li>从设备(Slave) ：已建立连接的设备，被动接受连接的一方</li>
</ul>
<div class="figure">
<img src="ble3.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<hr />
<h3 id="ble广播状态">BLE广播状态</h3>
<ul>
<li>广播包的发送是单向的，不需要任何连接</li>
<li>广播包可以包含特定的数据定义，最大31个字节</li>
<li>广播包可以直接指向某个特定的设备，也可以不指定</li>
<li>广播中可以声明是可被连接的设备，或者是不可连接的设备</li>
<li>在一个广播事件中，广播包会分别在三个广播通道中送一次(分别是37，38，39通道)</li>
<li>广播间隔: 两次广播事件之间的最小时间间隔</li>
<li>广播间隔的取值范围是在20ms ~ 10.24s之间</li>
<li>链路层会在每次广播事件期间产生一个随机延时时间，来避免多设备之间的数据碰撞。</li>
</ul>
<hr />
<h3 id="ble扫描状态">BLE扫描状态</h3>
<ul>
<li>每次扫描设备打开Radio接收器去监听广播包</li>
<li>扫描事件交替发生在三个特定的广播通道（37, 38, 39通道）</li>
<li>扫描间隔: 即扫描设备的扫描频度</li>
<li>扫描窗口: 每次扫描事件持续的时间</li>
</ul>
<div class="figure">
<img src="ble4.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<hr />
<h3 id="ble发起连接状态">BLE发起连接状态</h3>
<ul>
<li>除了扫描，设备也可以主动发起连接</li>
<li>当它监听到一个可连接的广播，发起设备会发送一个连接请求</li>
<li>连接请求包括一套为从设备准备的连接参数，安排连接事件发生的的通道和时间</li>
<li>如果广播设备接收了连接，两个设备会进入连接状态，发起方会称为主设备(Master)，广播方会称为从设备(Slave)</li>
<li>BLE连接参数:
<ul>
<li>通道映射：指示连接使用的频道</li>
<li>跳频增量：参与通道的选择算法<br /></li>
<li>连接间隔：即Connection Interval，1.25ms的倍数，7.5ms-4.0s之间</li>
<li>监督超时：即Slave latency，监督连接无响应的超时时间</li>
<li>从机潜伏：即Supervision timeout，从设备响应的潜伏时间</li>
</ul></li>
</ul>
<div class="figure">
<img src="ble5.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<hr />
<h3 id="ble连接状态">BLE连接状态</h3>
<ul>
<li>所有的通讯都发生在两个设备的连接事件期间</li>
<li>连接事件周期地发生，按照连接参数指定的间隔</li>
<li>每个事件发生在某个数据通道(0-36)，跳频增量参数决定了下次连接事件发生的通道</li>
<li>在每个连接事件期间，Master先发送，Slave会在150us之后做出回应</li>
<li>从设备潜伏:
<ul>
<li>Slave如果没有数据发送, 允许跳过连接事件</li>
<li>连接参数中的Slave 的潜伏值,是允许从设备跳过的最大连接次数</li>
<li>在连接事件中，如果slave没有对master的包做出回应，master会在后来的连接事件中重复发送，直到slave回应</li>
</ul></li>
</ul>
<h4 id="传输数据">传输数据</h4>
<div class="figure">
<img src="ble6.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<h4 id="超时断开">超时断开</h4>
<div class="figure">
<img src="ble7.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<h4 id="速度计算">速度计算</h4>
<div class="figure">
<img src="ble8.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<hr />
<h3 id="ble终止连接">BLE终止连接</h3>
<ul>
<li>Master和Slave都可以主动断开连接</li>
<li>一边发起断开，另一边必须在在断开连接之前回应这个断开请求</li>
<li>监视超时而断开连接
<ul>
<li>监视超时参数指定了两个数据包之间的最大时间跨度</li>
<li>slave和master双方都维持着自己的监视超时计时器，在每次收到数据包时清零。</li>
<li>如果连接超时，设备会认为连接丢失，并且退出连接状态，返回广播、扫描或者待机模式。</li>
</ul></li>
</ul>
<hr />
<h2 id="ble协议栈">BLE协议栈</h2>
<h3 id="协议栈分层">协议栈分层</h3>
<ul>
<li>由Controller和Host组成；
<ul>
<li>单芯片方案（SoC方案）：Controller、Host、Profile、Application在同一芯片中；</li>
<li>双芯片方案：Controller属于一个芯片，Host、Profile、Application属于另一个芯片（或系统）；</li>
</ul></li>
<li>HCI：Host Controller Interface</li>
<li>LL：Link Layer</li>
<li>L2CAP：Logical Link Control and Adaptation Protocol</li>
<li>ATT：Attribute Protocol</li>
<li>GATT：Generic Attribute Profile</li>
<li>GAP：Generic Access Profile</li>
<li>SMP：Security Manager Protocol</li>
</ul>
<div class="figure">
<img src="ble9.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<hr />
<h3 id="ble-link-layerll">BLE Link Layer(LL)</h3>
<ul>
<li>分组数据单元（PDU：packet data unit）</li>
</ul>
<hr />
<h3 id="ble-l2cap">BLE L2CAP</h3>
<ul>
<li>为上层协议提供connection-oriented和connection-less的支持</li>
<li>协议复用（经典蓝牙和低功耗蓝牙共存的情况下）</li>
<li>数据的分包与组包</li>
<li>流控与重传</li>
</ul>
<hr />
<h3 id="ble-att">BLE ATT</h3>
<ul>
<li>ATT：Attribute Protocol</li>
<li>Attribute就是data
<ul>
<li>Handle：属性在列表中的地址</li>
<li>Type：说明代表什么数据，由Bluetooth SIG预定义或者是客户自己定义的UUID (universal unique identifier)</li>
</ul></li>
<li>Permissions：权限声明</li>
<li>Client／Server架构
<ul>
<li>服务端提供数据，比如：contains attributes, receives requests, executes, responds, can indicate values</li>
<li>客户端使用数据，比如：sends requests, commands, waits for responses, can confirm indications</li>
<li>设备的服务/客户角色，不依赖于GAP层中心设备/外围设备角色，和LL层的Master/Slave角色定义，类似Socket</li>
</ul></li>
</ul>
<div class="figure">
<img src="ble10.png" alt="Smaller icon" />
<p class="caption">Smaller icon</p>
</div>
<hr />
<h3 id="ble-gatt">BLE GATT</h3>
<ul>
<li>GATT：Generic Attribute Profile
<ul>
<li>Profile通常是由一个或多个Services组成</li>
<li>一个Service包含一个或多个Characteristic values</li>
<li>Characteristic可以用descriptor来描述它的特性</li>
</ul></li>
<li>客户端和服务端的通讯方式
<ul>
<li>Discover Characteristic by UUID：搜索服务端设备所能提供的所有匹配UUID</li>
<li>Read Characteristic Value：使用指定的handle读Characteristic</li>
<li>Write Characteristic Value：使用指定的handle写Characteristic</li>
<li>Notification：服务端主动向客户端报告Characteristic的变化</li>
<li>Indication：客户端应用层需ACK</li>
</ul></li>
</ul>
<hr />
<h3 id="ble-gap">BLE GAP</h3>
<ul>
<li>GAP：Generic Access Profile</li>
<li>Basic requirements of a device</li>
<li>Description of behaviours and methods for device discovery, connection establishment, security, authentication, association models, service discovery</li>
<li>LE device roles: Peripheral, Central, etc.</li>
</ul>
<hr />
<h3 id="ble-smp">BLE SMP</h3>
<ul>
<li>SMP：Security Manager Protocol</li>
<li>Just Works: Gives an unauthenticated link</li>
<li>Man In The Middle protection: User enter passkey</li>
<li>Out-of-Band: Uses some other way to give a key</li>
</ul>

</div>
<div class="col-xs-6 col-sm-3" id="sidebar">
<div class="list-group">

<h4><Strong>SDK相关</Strong></h4>

<a href="http://www.juma.io/doc/zh/introduction/sdk/platform/overview.html">SDK介绍</a>
<ul class="menu_wwwzzjsnet">

</ul>

<a href="http://www.juma.io/doc/zh/introduction/sdk/feedback.html">交流和反馈</a>
<ul class="menu_wwwzzjsnet">

</ul>

<a href="http://www.juma.io/doc/zh/introduction/sdk/aboutus.html">关于我们</a>
<ul class="menu_wwwzzjsnet">

</ul>

<a href="http://www.juma.io/doc/zh/introduction/sdk/legal.html">法律</a>
<ul class="menu_wwwzzjsnet">

<li><a href="http://www.juma.io/doc/zh/introduction/sdk/legal/term_of_service.html">服务条款</a></li>

<li><a href="http://www.juma.io/doc/zh/introduction/sdk/legal/privacy_policy.html">隐私条款</a></li>

<li><a href="http://www.juma.io/doc/zh/introduction/sdk/legal/developer.html">开发者协议</a></li>

</ul>


<h4><Strong>技术话题</Strong></h4>

<a href="http://www.juma.io/doc/zh/introduction/topic/ble.html">BLE技术</a>
<ul class="menu_wwwzzjsnet">

<li><a href="http://www.juma.io/doc/zh/introduction/topic/ble/basics.html">BLE入门</a></li>

</ul>

<a href="http://www.juma.io/doc/zh/introduction/topic/iot.html">物联网技术</a>
<ul class="menu_wwwzzjsnet">

<li><a href="http://www.juma.io/doc/zh/introduction/topic/iot/async.html">论物联网与异步编程</a></li>

</ul>


</div>
</div><!--/.sidebar-offcanvas-->
</div><!--/row-->
<hr>
<footer>
<p>&copy; Juma Docs 2015</p>
</footer>
</div><!--/.container-->
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="http://www.juma.io/static/js/jquery.min.js"></script>
<script src="http://www.juma.io/static/js/bootstrap.min.js"></script>
</body>
</html>
